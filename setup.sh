#!/bin/bash

# ูุชุฌุฑ ุฅููุชุฑููู - ุณูุฑูุจุช ุงูุชุซุจูุช ูุงูุชุดุบูู
# E-Store - Installation and Run Script

echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ   ๐ ูุชุฌุฑู ุงูุฅููุชุฑููู - E-Store                 โ"
echo "โ   Professional E-Commerce Application            โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ุงูุชุญูู ูู Node.js ู npm
echo "๐ ุฌุงุฑู ุงูุชุญูู ูู ุงููุชุทูุจุงุช..."
if ! command -v node &> /dev/null; then
    echo "โ Node.js ุบูุฑ ูุซุจุช. ูุฑุฌู ุชุซุจูุช Node.js ุฃููุงู"
    exit 1
fi

if ! command -v npm &> /dev/null; then
    echo "โ npm ุบูุฑ ูุซุจุช. ูุฑุฌู ุชุซุจูุช npm ุฃููุงู"
    exit 1
fi

echo "โ Node.js ู npm ูุซุจุชุงู"
node_version=$(node --version)
npm_version=$(npm --version)
echo "   Node.js: $node_version"
echo "   npm: $npm_version"
echo ""

# ุงูุฐูุงุจ ูููุดุฑูุน
cd /workspaces/e-store-nodejs-app || exit 1

# ุชูุธูู ุดุงูู
echo "๐งน ุฌุงุฑู ุชูุธูู ุงููููุงุช ุงููุคูุชุฉ..."
rm -rf node_modules package-lock.json yarn.lock 2>/dev/null
npm cache clean --force 2>/dev/null
echo "โ ุชู ุงูุชูุธูู"
echo ""

# ุงูุชุซุจูุช
echo "๐ฆ ุฌุงุฑู ุชุซุจูุช ุงูููุชุจุงุช (ูุฏ ูุณุชุบุฑู ุฏูุงุฆู)..."
echo "   ูุฐู ุงูุนูููุฉ ูุฏ ุชุณุชุบุฑู ุจุนุถ ุงูููุชุ ูุฑุฌู ุงูุงูุชุธุงุฑ..."
echo ""

if npm install --legacy-peer-deps; then
    echo ""
    echo "โ ุชู ุชุซุจูุช ุงูููุชุจุงุช ุจูุฌุงุญ!"
    echo ""
    
    # ุงูุชุญูู ูู .env
    echo "๐ ุฌุงุฑู ุงูุชุญูู ูู ููู ุงูุชูููู..."
    if [ -f .env ]; then
        echo "โ ููู .env ููุฌูุฏ"
        # ุงูุชุญูู ูู MONGODB_URI
        if grep -q "MONGODB_URI" .env; then
            echo "โ MongoDB URI ูุญุฏุฏ"
        else
            echo "โ๏ธ  MongoDB URI ุบูุฑ ูุญุฏุฏ. ุงุณุชุฎุฏู ููู .env.example ููููุฐุฌ"
        fi
    else
        echo "โ๏ธ  ููู .env ุบูุฑ ููุฌูุฏ"
        echo "   ุณูุชู ุงุณุชุฎุฏุงู ุงูููู ุงูุงูุชุฑุงุถูุฉ"
    fi
    echo ""
    
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ   โ ุชุซุจูุช ุงููุชุฌุฑ ูุฌุญ ุจูุฌุงุญ!                    โ"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    echo "๐ ูุชุดุบูู ุงููุชุฌุฑ ุงุณุชุฎุฏู:"
    echo ""
    echo "   npm run dev"
    echo ""
    echo "ุฃู"
    echo ""
    echo "   npm start"
    echo ""
    echo "๐ ุซู ุงูุชุญ ูุชุตูุญู ุนูู:"
    echo ""
    echo "   http://localhost:3000"
    echo ""
    echo "๐ ุงูุตูุญุงุช ุงููุชุงุญุฉ:"
    echo "   โข / - ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ"
    echo "   โข /products - ุงูููุชุฌุงุช"
    echo "   โข /cart - ุณูุฉ ุงูุชุณูู"
    echo "   โข /login - ุชุณุฌูู ุงูุฏุฎูู"
    echo "   โข /register - ุงูุชุณุฌูู"
    echo ""
else
    echo ""
    echo "โ ูุดู ุชุซุจูุช ุงูููุชุจุงุช"
    echo ""
    echo "๐ง ุฌุฑุจ ุงูุญููู ุงูุชุงููุฉ:"
    echo ""
    echo "1๏ธโฃ  ุญุฐู node_modules ูุฏูููุง ูุฅุนุงุฏุฉ ุงููุญุงููุฉ"
    echo "2๏ธโฃ  ุงุณุชุฎุฏุงู yarn ุจุฏูุงู ูู npm: yarn install"
    echo "3๏ธโฃ  ุงูุชุญูู ูู ุงุชุตุงูู ุจุงูุฅูุชุฑูุช"
    echo "4๏ธโฃ  ุชุญุฏูุซ npm: npm install -g npm@latest"
    echo ""
    exit 1
fi
